
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Testing Frontend Â· SciCat Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.6.20">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Contributing.html" />
    
    
    <link rel="prev" href="Testing_catamel.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    SciCat Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Users/">
            
                <a href="../Users/">
            
                    
                    User Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../Users/Anonymous.html">
            
                <a href="../Users/Anonymous.html">
            
                    
                    Anonymous View
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../Users/Login.html">
            
                <a href="../Users/Login.html">
            
                    
                    Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../Users/Dashboard.html">
            
                <a href="../Users/Dashboard.html">
            
                    
                    Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../Users/Dataset_Details.html">
            
                <a href="../Users/Dataset_Details.html">
            
                    
                    Dataset Details
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../Users/Dataset_Details_Files.html">
            
                <a href="../Users/Dataset_Details_Files.html">
            
                    
                    Dataset Filelisting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../Users/Dataset_Attachments.html">
            
                <a href="../Users/Dataset_Attachments.html">
            
                    
                    Dataset Attachments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../Users/View_Raw_Metadata.html">
            
                <a href="../Users/View_Raw_Metadata.html">
            
                    
                    View Raw JSON data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../Users/Edit_Scientific_Metadata.html">
            
                <a href="../Users/Edit_Scientific_Metadata.html">
            
                    
                    Edit Scientific Metadata
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../Users/Publishing.html">
            
                <a href="../Users/Publishing.html">
            
                    
                    Dataset Publishing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../Users/Jobs.html">
            
                <a href="../Users/Jobs.html">
            
                    
                    Archival and Retrieval Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../Users/SampleData.html">
            
                <a href="../Users/SampleData.html">
            
                    
                    Sample Data Entry
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Operator/">
            
                <a href="../Operator/">
            
                    
                    Operator Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Operator/Step_by_Step_Setup.html">
            
                <a href="../Operator/Step_by_Step_Setup.html">
            
                    
                    Step by Step instruction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Operator/Step_by_Step_Setup_Docker.html">
            
                <a href="../Operator/Step_by_Step_Setup_Docker.html">
            
                    
                    Deploy with Docker Compose
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Operator/Step_by_Step_Setup_Kubernetes.html">
            
                <a href="../Operator/Step_by_Step_Setup_Kubernetes.html">
            
                    
                    Deploy with Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Operator/Sites/">
            
                <a href="../Operator/Sites/">
            
                    
                    Sites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../Operator/Sites/ESS.html">
            
                <a href="../Operator/Sites/ESS.html">
            
                    
                    ESS Site Specific info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../Operator/Sites/MaxIV.html">
            
                <a href="../Operator/Sites/MaxIV.html">
            
                    
                    MAX IV Site specific info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../Operator/Sites/PSI.html">
            
                <a href="../Operator/Sites/PSI.html">
            
                    
                    PSI Site specific info
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Ingestor/">
            
                <a href="../Ingestor/">
            
                    
                    Ingestor Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Ingestor/ingestManual.html">
            
                <a href="../Ingestor/ingestManual.html">
            
                    
                    Ingest Manual PSI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Ingestor/IngestManual_ESS.html">
            
                <a href="../Ingestor/IngestManual_ESS.html">
            
                    
                    Ingest Instructions ESS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../Ingestor/GettingMetadataIntoScicat.html">
            
                <a href="../Ingestor/GettingMetadataIntoScicat.html">
            
                    
                    Manual Ingest the Hard Way
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Developers Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="StartHere.html">
            
                <a href="StartHere.html">
            
                    
                    Overview of Backend and Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Data_Model.html">
            
                <a href="Data_Model.html">
            
                    
                    An Introduction to the Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="Running.html">
            
                <a href="Running.html">
            
                    
                    Running the Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="Environment.html">
            
                <a href="Environment.html">
            
                    
                    Configuration files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="Login.html">
            
                <a href="Login.html">
            
                    
                    Login and Accounts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="Ngrx.html">
            
                <a href="Ngrx.html">
            
                    
                    State Management in Angular
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="Testing_catamel.html">
            
                <a href="Testing_catamel.html">
            
                    
                    Testing Backend
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.8" data-path="Testing.html">
            
                <a href="Testing.html">
            
                    
                    Testing Frontend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="Contributing.html">
            
                <a href="Contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="Documentation.html">
            
                <a href="Documentation.html">
            
                    
                    Adding Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="Development_Methods.html">
            
                <a href="Development_Methods.html">
            
                    
                    Git Flow Workflow
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <a target="_blank" href="https://scicatproject.github.io/api/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Testing Frontend</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="testing"><a href="https://angular.io/docs/ts/latest/guide/testing.html" target="_blank">Testing</a></h1>
<p>All components of SciCat include unit test coverage and catanie has additional end to end user interface testing. Tests are run by CI before any change request is approved.</p>
<h1 id="e2e-protractor">E2E (<a href="http://www.protractortest.org/#/" target="_blank">Protractor</a>)</h1>
<p>Initially Protractor was used for end to end testing but this was abandoned in favour of the far more robust and flexible <a href="https://www.cypress.io/" target="_blank">Cypress</a>.</p>
<h1 id="cypress-e2e">Cypress E2E</h1>
<p>Cypress is not based on Selenium. </p>
<p><code>npx cypress run</code> runs all tests headless (without displaying the browser).</p>
<p><code>npx cypress open</code> opens the Cypress GUI in the browser.</p>
<p><code>npx cypress run --spec /home/encima/dev/melanie/catanie/cypress/integration/policy-delegate.spec.js</code> will run the single test file policy-delegate.spec.js.</p>
<h1 id="unit-jasmine-run-by-karma">Unit (Jasmine, run by Karma)</h1>
<p><code>ng test</code> runs all unit tests.</p>
<h3 id="mocking-services">Mocking Services</h3>
<p>Create a mock service and implement only what you need</p>
<pre><code>class MockUserApi {

  getCurrentId() {
    return 123;
  }
}
</code></pre><p>Now, set your testbed to override the service you are mocking.</p>
<pre><code>TestBed.overrideComponent(AppComponent, {
    set: {
      providers: [
        { provide: UserApi, useClass: MockUserApi }
      ]
    }
</code></pre><p>The practice I have followed is to create a <code>MockStubs</code> file that contains only the necessary mocked methods for services or pipes or components. This file can be added to to allow almost complete coverage of the app.</p>
<h1 id="anatomy-of-a-unit-test">Anatomy of a Unit Test</h1>
<h2 id="beforeeach">BeforeEach</h2>
<p>These are called to set up the test and involve 2 important methods.</p>
<h3 id="configuretestingmodule"><code>configureTestingModule</code></h3>
<p>This should include imports for all the modules used in the component. If the component also includes other components, then they should be included. This is also true for any pipes that may be used in the template. I am not sure if there is a fix for this but that does mean that, if a subcomponent uses a pipe then it should be included in all the specs.</p>
<h3 id="overridecomponent"><code>overrideComponent</code></h3>
<p>Test cases for a component should test as few things outside of the component as possible (services etc should have their own tests), but this causes problems for the services implemnted in each component. This is especially true for the loopback services, but also HTTP and Router. In the <code>overrideComponent</code> method, you can specify the service names and provide an alternative class to use.</p>
<p>For every service your component uses, there should be a <code>Mock</code> equivalent that provides hardcoded data in response to their calls. First, check the service exists in <code>MockStubs.ts</code> in the root of the <code>app</code> folder. If it is not in there, please implement it only in that file.  You do <strong>not</strong> need to implement every method, others can add to these when they are needed.</p>
<p>The format in the <code>spec</code> file should be as follows:</p>
<pre><code>{ provide: RawDatasetApi, useClass: MockDatasetApi }
</code></pre><p>The default test merely tests the creation of a component. This is merely opinion but a component should not be considered complete on a branch until the initial tests pass. A release should not go live untilthe coverage of the tests covers more than just basic functionality, i.e. 80% coverage.</p>
<h2 id="state-managementngrx-testing">State management/NGRX testing</h2>
<p>Tests of ngrx state management should test e.g. if a new state object is returned.</p>
<p>Sample ngrx reducer test:</p>
<pre><code class="lang-javascript">  describe(<span class="hljs-string">&apos;SelectDatasetAction&apos;</span>, <span class="hljs-function">() =&gt;</span> {
    it(<span class="hljs-string">&apos;should return the state&apos;</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data:DatasetInterface = {<span class="hljs-attr">owner</span>: <span class="hljs-string">&apos;&apos;</span>, <span class="hljs-attr">contactEmail</span>: <span class="hljs-string">&apos;&apos;</span>, <span class="hljs-attr">sourceFolder</span>: <span class="hljs-string">&apos;&apos;</span>, <span class="hljs-attr">creationTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(), <span class="hljs-attr">type</span>: <span class="hljs-string">&apos;&apos;</span>, <span class="hljs-attr">ownerGroup</span>: <span class="hljs-string">&apos;&apos;</span>};
      <span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">new</span> Dataset({<span class="hljs-attr">pid</span>: <span class="hljs-string">&apos;pid 1&apos;</span>, ...data});
      <span class="hljs-keyword">const</span> action = <span class="hljs-keyword">new</span> fromActions.SelectDatasetAction(payload);
      <span class="hljs-keyword">const</span> state = fromDatasets.datasetsReducer(initialDatasetState, action);
      expect(state.selectedSets2).toEqual([payload]);
      expect(state.selectedSets2.constructor).toBe(<span class="hljs-built_in">Array</span>);
    });
  });
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Testing_catamel.html" class="navigation navigation-prev " aria-label="Previous page: Testing Backend">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Contributing.html" class="navigation navigation-next " aria-label="Next page: Contributing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Testing Frontend","level":"1.5.8","depth":2,"next":{"title":"Contributing","level":"1.5.9","depth":2,"path":"Development/Contributing.md","ref":"Development/Contributing.md","articles":[]},"previous":{"title":"Testing Backend","level":"1.5.7","depth":2,"path":"Development/Testing_catamel.md","ref":"Development/Testing_catamel.md","articles":[]},"dir":"ltr"},"config":{"plugins":["chapter-fold"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"SciCat Documentation","gitbook":"*"},"file":{"path":"Development/Testing.md","mtime":"2021-04-14T07:47:27.383Z","type":"markdown"},"gitbook":{"version":"3.6.20","time":"2021-04-14T07:47:38.809Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

